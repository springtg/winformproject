SELECT PKG_SBC_COMMON.FN_GET_CUSTOMER('QD', B.CUST_CD) AS CUST_NAME,
       PKG_SBC_COMMON.FN_GET_ITEM_NAME(B.ITEM_CD)      AS ITEM_NAME,
	   PKG_SBC_COMMON.FN_GET_SPEC_NAME(B.SPEC_CD)      AS SPEC_NAME,
	   PKG_SBC_COMMON.FN_GET_COLOR_NAME(B.COLOR_CD)    AS COLOR_NAME,
	   SUM(B.PUR_QTY)                                  AS PUR_QTY,
	   PKG_SBC_COMMON.FN_GET_STOCK_UNIT(B.ITEM_CD)     AS ITEM_UNIT,
	   MAX(B.CBD_PRICE)                                AS CBD_PRICE,
	   MAX(B.PUR_PRICE)                                AS PUR_PRICE,
	   MIN(B.PUR_CURRENCY)                             AS PUR_CURRENCY,
	   SUM(B.PUR_QTY) * MAX(B.PUR_PRICE)               AS PUR_AMOUNT
  FROM SEPHIROTH.SBP_PURCHASE_HEAD@QDLINK A, SEPHIROTH.SBP_PURCHASE_TAIL@QDLINK B, SEPHIROTH.SBC_ITEM C
 WHERE A.FACTORY = B.FACTORY
   AND A.PUR_NO  = B.PUR_NO
   AND B.ITEM_CD = B.ITEM_CD
   AND A.FACTORY = [1;공장;C;SBC21]
   AND A.PUR_YMD BETWEEN [2;발주일 From;D] AND [3;발주일 To;D]
   AND NVL(C.IMPORT_QD, 'N') LIKE TRIM([4;자재구분;C;SBP13]) || '%'     
 GROUP BY B.CUST_CD, B.ITEM_CD, B.SPEC_CD, B.COLOR_CD
 ORDER BY CUST_NAME, ITEM_NAME, SPEC_NAME, COLOR_NAME