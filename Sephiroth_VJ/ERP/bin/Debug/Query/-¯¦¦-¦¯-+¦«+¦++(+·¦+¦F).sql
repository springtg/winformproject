SELECT A.PUR_NO, A.PUR_YMD,
       B.CUST_CD AS VENDOR_CODE, 
       PKG_SBC_COMMON.FN_GET_CUSTOMER('QD', B.CUST_CD) AS VENDOR_NAME,  
       A.RTA_YMD,
       A.PUR_USER, MAX(A.STATUS) AS STATUS,
       PKG_SBC_COMMON.FN_GET_COMMON(A.FACTORY, 'SBP11', A.PUR_DIV)      AS REASON,  
       PKG_SBC_COMMON.FN_GET_ITEM_NAME(B.ITEM_CD) AS ITEM_NAME,
       PKG_SBC_COMMON.FN_GET_SPEC_NAME(B.SPEC_CD) AS SPEC_NAME,
       PKG_SBC_COMMON.FN_GET_COLOR_NAME(B.COLOR_CD) AS COLOR_NAME, 
       SUM(B.PUR_QTY) AS PUR_QTY, SUM(NVL(B.IN_QTY, 0)) AS IN_QTY, C.MNG_UNIT,
       MAX(B.PUR_CURRENCY) AS PUR_CURRENCY, MAX(B.PUR_PRICE) AS PUR_PRICE,
       DECODE(C.IMPORT_QD, 'L', 'Local', 'T', 'LLT', 'S', 'DS Shipping', '-') AS IMPORT_QD, 
       PKG_SBC_COMMON.FN_GET_CUSTOMER('QD', B.CUST_CD) AS VENDOR_NAME,
       B.ITEM_CD, B.SPEC_CD, B.COLOR_CD
  FROM SBP_PURCHASE_HEAD A, SBP_PURCHASE_TAIL B, SBC_ITEM C
 WHERE A.FACTORY = B.FACTORY
   AND A.PUR_NO  = B.PUR_NO
   AND B.ITEM_CD = C.ITEM_CD   
   AND A.FACTORY  = [1;공장;C;SBC21]
   AND A.PUR_YMD  BETWEEN [2;발주일 From;D] AND [3;발주일 To;D]
   AND NVL(TRIM(B.CUST_CD), '-')  LIKE TRIM([4;거래처코드;T]) || '%'
   AND NVL(TRIM(A.PUR_USER), '-') LIKE TRIM([5;등록자;U])     || '%'
   AND NVL(TRIM(A.PUR_DIV), '-')  LIKE [6;사유;C;SBP11]       || '%'   
   AND NVL(TRIM(C.ITEM_NAME1), '-') LIKE TRIM([7;자재명;T])   || '%'
   AND NVL(TRIM(C.GROUP_CD), '-')   LIKE TRIM([8;그룹코드;T]) || '%'
 GROUP BY A.FACTORY, A.PUR_NO, A.PUR_YMD, A.RTA_YMD, B.CUST_CD, A.PUR_USER, A.PUR_DIV, C.MNG_UNIT,
       C.IMPORT_QD,  B.ITEM_CD, B.SPEC_CD, B.COLOR_CD
 ORDER BY B.CUST_CD, ITEM_NAME, SPEC_NAME, COLOR_NAME